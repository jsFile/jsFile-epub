!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("JsFile")):"function"==typeof define&&define.amd?define(["JsFile"],b):"object"==typeof exports?exports.JsFileEpub=b(require("JsFile")):a.JsFileEpub=b(a.JsFile)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},i=c(1),j=c(2),k=d(j),l={extension:["epub"],mime:["application/epub+zip"]},m=function(a){function b(){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments),this.createDocument=k["default"],this.parser="readArchive",this.files=l}return f(b,a),g(b,null,[{key:"test",value:function(a){return Boolean(a&&i.Engine.validateFile(a,l))}},{key:"mimeTypes",value:l.mime.slice(0),enumerable:!0}]),b}(i.Engine);i.defineEngine(m),b["default"]=m,a.exports=b["default"]},function(b,c){b.exports=a},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=d(e),g=c(3),h=d(g),i=c(7),j=(d(i),c(8)),k=d(j),l=c(9),m=d(l),n=f["default"].Engine.normalizeDataUri,o=/\.x?html$/i,p=/\/?[^\/]+\//;b["default"]=function(a){return new Promise(function(b,c){var d=[],e=this.fileName,f={styles:{},media:{}},g={},i=new DOMParser;a.forEach(function(a){if(a.file){var b=void 0,c=a.entry.filename,e=Boolean(c&&c.indexOf("/images/")>=0),j=Boolean(!e&&c&&c.indexOf("/fonts/")>=0),k=j||e;k&&(b="readAsDataURL"),d.push(this.readFileEntry({file:a.file,method:b}).then(function(a){var b=c.replace(p,"");k?f.media[b]={data:n(a,c)}:c.indexOf(".opf")>=0?h["default"](f,i.parseFromString(a,"application/xml")):o.test(c)?g[b]=i.parseFromString(a,"application/xml"):c.indexOf("css/")>=0&&(f.styles[b]=a)}))}},this),Promise.all(d).then(function(){var a=new m["default"]({meta:{name:e},content:[],styles:[]});a._rawHtml=k["default"](g,f),b(a)},c)}.bind(this))},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=d(e),g=c(5),h=d(g),i=c(6),j=d(i);b["default"]=function(a,b){return[].forEach.call(b&&b.childNodes&&b.childNodes[0]&&b.childNodes[0].childNodes||[],function(b){switch(b.localName){case"metadata":a.documentInfo=f["default"](b);break;case"manifest":a.manifest=h["default"](b);break;case"spine":a.spine=j["default"](b)}}),a},a.exports=b["default"]},function(a,b){"use strict";function c(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(b,"__esModule",{value:!0});var d=Function.prototype.bind;b["default"]=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return[].forEach.call(a&&a.childNodes||[],function(a){var e=a.localName,f=a.textContent,g=void 0===f?"":f;if("date"===e){var h=g.split("-");h[1]=(h[1]||1)-1,b[e]=new(d.apply(Date,[null].concat(c(h))))}else"identifier"===e?b.id=g:e&&(b[e]=g)}),b},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=d(e),g=f["default"].Engine.formatPropertyName;b["default"]=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=[].forEach;return c.call(a&&a.childNodes||[],function(a){var d=a.attributes,e=void 0===d?{}:d,f=e.id&&e.id.value;f&&(b[f]={},c.call(e,function(a){var c=a.name,d=a.value;"id"!==c&&(b[f][g(c)]=d)}))}),b},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=d(e),g=f["default"].Engine,h=g.formatPropertyName,i=g.attributeToBoolean;b["default"]=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];b.items=[],b.indices={};var c=[].forEach;return c.call(a&&a.childNodes||[],function(a){var d=a.attributes,e=void 0===d?{}:d,f=e.idref&&e.idref.value;f&&!function(){var a={id:f};c.call(e,function(b){var c=b.name,d=b.value;"idref"!==c&&("linear"===c?a.linear=i(d):a[h(c)]=d)}),b.indices[f]=b.items.push(a)-1}()}),b},a.exports=b["default"]},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=function(a){var b=[];return b},a.exports=b["default"]},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e=c(1),f=e.Document.elementPrototype,g=f.properties.tagName,h="jf-page";b["default"]=function(a,b){var c=document.createDocumentFragment(),e=b.spine,f=b.manifest,i=b.media,j=b.styles,k=[].forEach,l={};if(!e||!e.items)return c;e.items.forEach(function(b){var e=b.id,m=f[e],n=m&&a[m.href];if(n){var o=document.createElement(g),p=n.querySelector("body");o.setAttribute("class",h),p&&(k.call(n.querySelectorAll("head > link"),function(a){var b=a.attributes,c=b.href&&/[\.\/]*css\/[^"]+/.exec(b.href.value)||[],e=d(c,1),f=e[0],g=f&&j[f];g&&(l[f]||(l[f]={selectors:["."+h],src:g.replace(/[\.\/]*(images|fonts)\/[^"]+/g,function(a){a=a.replace(/^[\.\/]+/,"");var b=i[a];return b&&b.data||""})}))}),o.innerHTML+=p.innerHTML,o.innerHTML=o.innerHTML.replace(/[\.\/]*(images|fonts)\/[^"]+/g,function(a){var b=i[a];return b&&b.data||""})),c.appendChild(o)}});var m="",n=0;for(var o in l)l.hasOwnProperty(o)&&!function(){for(var a=/width\s*\:\s*([0-9]+)px/g,b=l[o],c=b.src,d=a.exec(c);d;)d[1]>n&&(n=Number(d[1])),d=a.exec(c);c=c.replace(/\s*[^\{}\/]+\{/g,function(a){return a=a.trim(),"@"===a[0]?a:a.split(/\s*,\s*/).map(function(a){return b.selectors.map(function(b){return" "+b+" "+a}).join(",")}).join(",")}),m+=c+"\n"}();if(m){m+="\n."+h+" {",n&&(m+="width:"+n+"px;"),m+="position:relative;}";var p=document.createElement("style");p.appendChild(document.createTextNode(m)),c.appendChild(p)}return c},a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},h=c(1),i=function(a){function b(){d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return e(b,a),f(b,[{key:"html",value:function(){return this._rawHtml}}]),b}(h.Document);b["default"]=i,a.exports=b["default"]}])});